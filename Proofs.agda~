----------------------------------------------------------------------
-- This module contains the proofs for the stack-machine's compiler --
-- authors: Matthew Thompson, Natalie Ravenhill, Yu-Yang Lin        --
----------------------------------------------------------------------
module Proofs where

open import Data.Nat
open import Data.Bool renaming (Bool to ğ”¹; _âˆ§_ to oldand)
open import Data.List 
open import Data.Product
open import Relation.Binary.PropositionalEquality renaming ([_] to âŸª_âŸ«)
open import Data.Maybe
open import Data.String renaming (_++_ to _^_)

open import AbstractSyntax
open import DenSemantics
open import CompExp

-------------------------
-- PROOF FOR SOUNDNESS --
-------------------------
--anything that has not been defined in compile will just be Err 
sound : (T : Set) (e : Exp T) (p : program) (n : â„•)(Ïƒ : state) (k : â„•) â†’
        âŸ¨âŸ¨ compile e âŸ©âŸ© [] , Ïƒ , k â‰¡ just [ n ] â†’ âŸ¦ e âŸ§ Ïƒ â‰¡ just n 

--Booleans (Natalie)
sound .ğ”¹ (B x) p n Ïƒ zero () --can't have just [] â‰¡ just [ n ] so false
sound .ğ”¹ (B x) p n Ïƒ (suc k) () --can't have  nothing â‰¡ just [ n ]  so false  

--Constants (Natalie)
sound .â„• (N x) p n Ïƒ zero ()  --can't have just [] â‰¡ just n so false
sound .â„• (N zero) p zero Ïƒ (suc k) pf = refl
sound .â„• (N zero) p (suc n) Ïƒ (suc k) ()
sound .â„• (N (suc x)) p .(suc x) Ïƒ (suc k) refl = refl

--Variables (?)
sound .â„• (V x) p n Ïƒ k  with Ïƒ x
sound .â„• (V x) p n Ïƒ zero | just v  = {!!}
sound .â„• (V x) p n Ïƒ (suc k) | just v  = {!!}
... | nothing  = {!!}

 -- where 
{-   lemma3 : âŸ¨âŸ¨ [ Var x ] âŸ©âŸ© [] , Ïƒ , k â‰¡ just [ n ] â†’ Ïƒ x â‰¡ just n
   lemma3 = {!!}-}

--Addition (?)
--âŸ¨âŸ¨ (compile e ++ compile eâ‚) ++ [ Add ] âŸ©âŸ© [] , Ïƒ , k â‰¡ just [ n ] â†’  (e _.+' eâ‚) Ïƒ (âŸ¦ e âŸ§ Ïƒ) (âŸ¦ eâ‚ âŸ§ Ïƒ) â‰¡ just n
sound .â„• (e âŠ• eâ‚) p n Ïƒ k = {!!}

--Conditionals (?)
-- âŸ¨âŸ¨ [ Err ] âŸ©âŸ© [] , Ïƒ , k â‰¡ just [ n ] â†’  (âŸ¦ if e then eâ‚ else eâ‚‚ âŸ§ Ïƒ | âŸ¦ e âŸ§ Ïƒ) â‰¡ just n
sound .â„• (if_then_else e eâ‚ eâ‚‚) p n Ïƒ k = {!!}
  
------------------------
-- PROOF FOR ADEQUACY --
------------------------
adeq : (T : Set) (e : Exp T) (p : program) (Ïƒ : state) (n : â„•) â†’
        âŸ¦ e âŸ§ Ïƒ â‰¡ just n â†’ (âˆƒ Î» k â†’ âŸ¨âŸ¨ compile e âŸ©âŸ© [] , Ïƒ , k â‰¡ just [ n ])
adeq .ğ”¹ (B x) p Ïƒ n xâ‚ = {!!}
adeq .â„• (N x) p Ïƒ n xâ‚ = {!!}
adeq .â„• (V x) p Ïƒ n xâ‚ = {!!}
adeq .â„• (e âŠ• eâ‚) p Ïƒ n x = {!!}
adeq .â„• (if_then_else e eâ‚ eâ‚‚) p Ïƒ n x = {!!}
              
adeq-fail : (T : Set) (e : Exp T) (p : program) (Ïƒ : state) (n : â„•) â†’
        âŸ¦ e âŸ§ Ïƒ â‰¡ nothing â†’ (âˆƒ Î» k â†’ âŸ¨âŸ¨ compile e âŸ©âŸ© [] , Ïƒ , k â‰¡ nothing)
adeq-fail = {!!}
