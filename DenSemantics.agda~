--------------------------------------------------------------------
-- This module contains the Denotational Semantics for AbstractSyntax.agda --
-- authors: Matthew Thompson, Natalie Ravenhill, Yu-Yang Lin      --
--------------------------------------------------------------------
module DenSemantics where

open import Data.Nat
open import Data.Bool renaming (Bool to ğ”¹; _âˆ§_ to oldand)
open import Data.List 
open import Data.Product
open import Relation.Binary.PropositionalEquality renaming ([_] to âŸª_âŸ«)
open import Data.Maybe
open import Data.String renaming (_++_ to _^_; _==_ to _â‰¡â‰¡_)

-- module imports for the Expressions.
open import AbstractSyntax
open import CompExp

âŸ¦_âŸ§ : âˆ€ {T} â†’ Exp T â†’ state â†’ Maybe â„•
âŸ¦ B( true ) âŸ§ Ïƒ = just (suc zero)
âŸ¦ B( false ) âŸ§ Ïƒ = just zero
âŸ¦ N(v) âŸ§ Ïƒ = just v
âŸ¦ V(s) âŸ§ Ïƒ = Ïƒ s

âŸ¦ E âŠ• E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ +' âŸ¦ E' âŸ§ Ïƒ where
  _+'_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m +' just n = just (m + n)
  _      +' _      = nothing

âŸ¦ E âŠ E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ -' âŸ¦ E' âŸ§ Ïƒ where
 _-'_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„• 
 just m -' just n = just (m âˆ¸ n)
 _      -' _      = nothing

âŸ¦ Â¬( E ) âŸ§ Ïƒ with âŸ¦ E âŸ§ Ïƒ
... | just zero = just (suc zero)
... | just (suc _) = just zero
... | nothing = nothing

âŸ¦ E & E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ &' âŸ¦ E' âŸ§ Ïƒ where
  _&'_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m &' just n = just (m andN n)
  _      &' _      = nothing

âŸ¦ E âˆ¥ E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ âˆ¥' âŸ¦ E' âŸ§ Ïƒ where
  _âˆ¥'_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m âˆ¥' just n = just (m orN n)
  _      âˆ¥' _      = nothing

âŸ¦ E <= E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ <=' âŸ¦ E' âŸ§ Ïƒ where
  _<='_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m <=' just n = just ((suc n) âˆ¸ m)
  _      <=' _      = nothing

âŸ¦ E >= E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ >=' âŸ¦ E' âŸ§ Ïƒ where
  _>='_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m >=' just n = just ((suc m) âˆ¸ n)
  _      >=' _      = nothing

âŸ¦ E == E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ ==' âŸ¦ E' âŸ§ Ïƒ where
  _=='_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m ==' just n = just (((suc m) âˆ¸ n) andN ((suc n) âˆ¸ m))
  _      ==' _      = nothing

âŸ¦ if E then Eâ€² else Eâ€³ âŸ§ Ïƒ with âŸ¦ E âŸ§ Ïƒ
...  | just zero    = âŸ¦ Eâ€³ âŸ§ Ïƒ
...  | just (suc _) = âŸ¦ Eâ€² âŸ§ Ïƒ
...  | nothing      = nothing

--âŸ¦ for E do E' âŸ§ Ïƒ = {!!} -- TODO

âŸ¦ E âŠ— E' âŸ§ Ïƒ = âŸ¦ E âŸ§ Ïƒ âŠ—' âŸ¦ E' âŸ§ Ïƒ where
  _âŠ—'_ : Maybe â„• â†’ Maybe â„• â†’ Maybe â„•
  just m âŠ—' just n = just (m * n)
  _      âŠ—' _      = nothing

âŸ¦ _ âŸ§ _ = nothing

e0 : Exp â„•
e0 =  N(1) âŠ• N(1) âŠ• V("x")

x0 : Maybe â„•
x0 = âŸ¦ e0 âŸ§ (Î» v â†’ nothing)

x1 : Maybe â„•
x1 = âŸ¦ e0 âŸ§ (Î» v â†’ just 1)

x2 : Maybe stack
x2 = âŸ¨âŸ¨ compile e0 âŸ©âŸ© [] , (Î» v â†’ just 1) , 10

if1 : Maybe stack
if1 = âŸ¨âŸ¨ compile ((if N(0) then N(4) else) (N(3)) ) âŸ©âŸ© [] , (Î» x -> just 0) , 999

subt : Maybe stack
subt = âŸ¨âŸ¨ compile ((N 28) âŠ (N 6)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

timest : Maybe stack
timest = âŸ¨âŸ¨ compile ((N 28) âŠ— (N 123)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

-- 12/0 = nothing
divt1 : Maybe stack
divt1 = âŸ¨âŸ¨ compile ((N 12) âŠ˜ (N 0)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

-- 12/3 = 4
divt2 : Maybe stack
divt2 = âŸ¨âŸ¨ compile ((N 12) âŠ˜ (N 3)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

-- 12/7 = 1
divt3 : Maybe stack
divt3 = âŸ¨âŸ¨ compile ((N 12) âŠ˜ (N 7)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

-- 12/13 = 0
divt4 : Maybe stack
divt4 = âŸ¨âŸ¨ compile ((N 12) âŠ˜ (N 13)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

gtet : Maybe stack
gtet = âŸ¨âŸ¨ compile ((N 62) >= (N 62)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

ltet : Maybe stack
ltet = âŸ¨âŸ¨ compile ((N 63) <= (N 62)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

eqt1 : Maybe stack
eqt1 = âŸ¨âŸ¨ compile ((N 212321) == (N 22)) âŸ©âŸ© [] , (Î» x -> just 0) , 999
 
eqt2 : Maybe stack
eqt2 = âŸ¨âŸ¨ compile ((N 1234) == (N 1234)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

-- 28 * 123 - 6 = 3438
aritht1 : Maybe stack
aritht1 = âŸ¨âŸ¨ compile ((N 28) âŠ— (N 123) âŠ (N 6)) âŸ©âŸ© [] , (Î» x -> just 0) , 999

-- 999 + 321 * 123 = 40482
aritht2 : Maybe stack
aritht2 = âŸ¨âŸ¨ compile ((N 999) âŠ• (N 321) âŠ— (N 123)) âŸ©âŸ© [] , (Î» x -> just 0) , 10000

--
aritht3 : Maybe stack
aritht3 = âŸ¨âŸ¨ compile ((N 999) âŠ˜ (N 21) âŠ• (N 321) âŠ— (N 123) âŠ˜ (N 48)) âŸ©âŸ© [] , (Î» x -> just 0) , 100000

